<VirtualHost *:80>
    ServerName data.vlaanderen.be


    ScriptLog logs/cgi_log
    ScriptAlias "/cgi-bin/" "/scripts/"
    AddHandler cgi-script .sh

    <Directory /scripts/>
    # provide access to the local volume
	Options Indexes 
	AllowOverride None
	Require all granted
    </Directory>

    <Directory /cgi-bin/>
    # provide access to the local volume
	Options Indexes 
	AllowOverride None
	Require all granted
    </Directory>


    <Directory /www/>
    # provide access to the local volume
	Options Indexes FollowSymLinks
	AllowOverride None
	Require all granted
    </Directory>

    DocumentRoot "/www"

    # customize global default 404 page 
    # indien afgehandeld binnen zelfde vhost is alle benodigde informatie beschikbaar via environment variables
    ErrorDocument 404 /cgi-bin/error.sh

    RewriteEngine On
    LogLevel alert rewrite:trace5


# if not of the accepted classes then stop
# accept cgi-bin otherwise error-handling is blocked
    RewriteCond %{REQUEST_URI} !^/(id|doc|meta|raw|ns|cgi-bin).* 
    RewriteRule "^(.*)$" - [E=errorUriScheme:0,R=404]

# empty category not allowed
    RewriteCond %{REQUEST_URI} ^/(id|doc|meta|raw)$
    RewriteRule "^(.*)$" - [E=errorUriScheme:1,R=404]

    RewriteCond %{REQUEST_URI} ^/(id|doc|meta|raw)/$
    RewriteRule "^(.*)$" - [E=errorUriScheme:1,R=404]

# empty accept header not allowed => send possibilities
    RewriteCond "%{HTTP_ACCEPT}" ""
    RewriteRule "^(.*)$" /cgi-bin/alternatives.sh [R=303]

# handle id case

    RewriteCond "%{REQUEST_URI}" "^/id/.*"
    RewriteCond "%{HTTP_ACCEPT}" "(application/rdf+xml|text/turtle)"
    RewriteRule "^/id/(.*)$" http://id.vlaanderen.be/doc/$1 [R=303]
#    RewriteRule "^/id/(.*)$" http://oslo-rdfstore3.westeurope.cloudapp.azure.com:8890/sparql?query=describe\ <http://id.vlaanderen.be/id/$1> [R=303]

    RewriteCond "%{REQUEST_URI}" "^/id/.*"
    RewriteCond "%{HTTP_ACCEPT}" "(text/html)"
    RewriteRule "^/id/(.*)$" http://oslo-elda.westeurope.cloudapp.azure.com:8080/elda-common/about?resource=http://id.vlaanderen.be/id/$1 [R=303]
#    RewriteRule "^/id/(.*)$" http://id.vlaanderen.be/doc/$1 [R=303]

# handle doc case
    RewriteCond "%{REQUEST_URI}" "^/doc/.*"
    RewriteRule "^/doc/(.*)$" http://agiv.be/ [R]

# handle raw case
    RewriteCond "%{REQUEST_URI}" "^/raw/.*"
    RewriteRule "^/raw/(.*)$" $1 [L]

# handle ns case
    # root ns case
    RewriteCond "%{REQUEST_URI}" "^/ns$"
    RewriteCond "%{HTTP_ACCEPT}" "text/html"
    RewriteRule "^/ns" /ns/generic.html [END]

    RewriteCond "%{REQUEST_URI}" "^/ns$"
    RewriteCond "%{HTTP_ACCEPT}" "application/rdf+xml"
    RewriteRule "^/ns" /ns/generic.rdf [END]

    RewriteCond "%{REQUEST_URI}" "^/ns$"
    RewriteCond "%{HTTP_ACCEPT}" "text/turtle"
    RewriteRule "^/ns" /ns/generic.ttl [END]

    # ontology domain specific
      # capture file endings
    RewriteCond "%{REQUEST_URI}" "^/ns/(.*).ttl"
    RewriteRule "^/ns/(.*)$" /ns/$1.ttl [END]

    RewriteCond "%{REQUEST_URI}" "^/ns/(.*).rdf"
    RewriteRule "^/ns/(.*)$" /ns/$1.rdf [END]

    RewriteCond "%{REQUEST_URI}" "^/ns/(.*).html"
    RewriteRule "^/ns/(.*)$" /ns/$1.html [END]

      # capture the domain
    RewriteCond "%{REQUEST_URI}" "^/ns/(.*)"
    RewriteCond "%{HTTP_ACCEPT}" "text/html"
    RewriteRule "^/ns/(.*)$" /ns/$1.html [END]

    RewriteCond "%{REQUEST_URI}" "^/ns/(.*)"
    RewriteCond "%{HTTP_ACCEPT}" "application/rdf+xml"
    RewriteRule "^/ns/(.*)$" /ns/$1.html [END]

    RewriteCond "%{REQUEST_URI}" "^/ns/(.*)"
    RewriteCond "%{HTTP_ACCEPT}" "text/turtle"
    RewriteRule "^/ns/(.*)$" /ns/$1.html [END]




</VirtualHost>

<VirtualHost *:81>
  # handle errors on a different port 
    ServerName data.vlaanderen.be

    ScriptLog logs/cgi_log
    ScriptAlias "/cgi-bin/" "/scripts/"
    AddHandler cgi-script .sh

    <Directory /scripts/>
    # provide access to the local volume
	Options Indexes 
	AllowOverride None
	Require all granted
    </Directory>

    <Directory /cgi-bin/>
    # provide access to the local volume
	Options Indexes 
	AllowOverride None
	Require all granted
    </Directory>

</VirtualHost>

# obsolete knowledge
    #ErrorDocument 404 /error/error.domain.html
    # indien error document start met http dan worden de environment variables niet gezet.
    #ErrorDocument 404 http://data.vlaanderen.be:81/cgi-bin/error.sh?uri=%{escape:%{HTTP_REFERER}}
#    RewriteRule "^(.*)$" /ErrorPages/error.domain.html [R=404]  
#    RewriteRule "^(.*)$" /error/error.emptytype.html [E=errorUriScheme:1,R=404]
#    RewriteRule "^/(.*)$" http://data.vlaanderen.be:81/cgi-bin/error.sh?uri=$1 [R=303]

# manage the error messages
#    RewriteCond %{REQUEST_URI} "^/error/.*" 
#    RewriteRule "^/error/(.*)" /ErrorPages/$1 [L]
